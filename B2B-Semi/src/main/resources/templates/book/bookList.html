<!DOCTYPE html>
<html lang="ko" xmlns:th="http://thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Book Community</title>

	<link rel="stylesheet" href="/css/book/bookList.css">

	<!-- templates/common/common.html 조각으로 추가 -->
	<th:block th:replace="~{common/common}"></th:block>

</head>

<body>
	<div class="wrapper">
		<!-- 헤더 추가 -->
		<th:block th:replace="~{common/header}"></th:block>

		<!-- 사이드 추가 -->
		<th:block th:replace="~{sideMenu/sideMenu-book}"></th:block>

		<main class="main-content">

			<section class="ranking-header">
				<h1 class="ranking-title">
					<i class="fas fa-crown me-2" style="color: #FFD700;"></i>
					도서 목록
				</h1>
			</section>

			<section class="genre-section">
				<form th:action="@{bookList}" method="get" id="bookSearch">
					<div class="search-section">
						<div class="search-wrapper">
							
							<div class="input-group flex-grow-1">
								<select class="form-select" name="searchType" style="border-radius: 8px;" th:value="${searchType}">
									<option th:value="title" th:selected="${searchType == 'title'}">제목</option>
									<option th:value="author" th:selected="${searchType == 'author'}">작가</option>
								</select>
								<input type="text" class="form-control" name="searchInput" placeholder="검색어를 입력하세요"
									style="border-radius: 8px;" th:value="${searchInput}">
							</div>
							
							<select class="form-select filter-select" name="genreFilter" th:value="${genreFilter}">
								<option th:value="all" 		th:selected="${genreFilter == 'all'}">전체 장르</option>
								<option th:value="소설" 	th:selected="${genreFilter == '소설'}">소설</option>
								<option th:value="시" 		th:selected="${genreFilter == '시'}">시</option>
								<option th:value="에세이" 	th:selected="${genreFilter == '에세이'}">에세이</option>
								<option th:value="자기계발" th:selected="${genreFilter == '자기계발'}">자기계발</option>
							</select>
							
							<select class="form-select filter-select" name="ratingFilter" th:value="${ratingFilter}">
								<option value="">전체 평점</option>
								<option th:value="9"	th:selected="${ratingFilter == '9'}">9점대</option>
								<option th:value="8"	th:selected="${ratingFilter == '8'}">8점대</option>
								<option th:value="7"	th:selected="${ratingFilter == '7'}">7점대</option>
								<option th:value="6"	th:selected="${ratingFilter == '6'}">6점대</option>
							</select>
							
							<button class="search-button">
								<i class="fas fa-search"></i>검색
							</button>
							
						</div>
					</div>
				</form>
			</section>

			<section class="genre-section">
				<div class="table-responsive">
					<table class="table table-hover">
						<thead>
							<tr>
								<th style="width: 8%;" onclick="sortTable(0)">
									구분
									<span class="sort-icon">
										<i class="fas fa-sort"></i>
									</span>
								</th>
								
								<th style="width: 35%;" onclick="sortTable(0)">
									제목 (평점)
									<span class="sort-icon">
										<i class="fas fa-sort"></i>
									</span>
								</th>
								
								<th style="width: 25%;" onclick="sortTable(1)">
									작가
									<span class="sort-icon">
										<i class="fas fa-sort"></i>
									</span>
								</th>
								
								<th style="width: 20%;" onclick="sortTable(2)">
									장르
									<span class="sort-icon">
										<i class="fas fa-sort"></i>
									</span>
								</th>
								
								<th style="width: 12%;" onclick="sortTable(3)">
									출판일
									<span class="sort-icon">
										<i class="fas fa-sort"></i>
									</span>
								</th>
							</tr>
						</thead>
						<tbody id="bookList">
							<th:block th:if="${#lists.isEmpty(bookList)}">
								<tr>
									<th colspan="5">게시글이 존재하지 않습니다.</th>
								</tr>
							</th:block>

							<th:block th:unless="${#lists.isEmpty(bookList)}">
								
								<tr th:each="book, iterStat : ${bookList}" th:object="${book}">
									<td th:text="${book.rowNum}" style="text-align: center;">구분번호</td>
									<td>
										<div class="book-title"
											th:data-full-text="${book.title + ' (★' + book.customerReviewRank + ')'}"
											onmousemove="showTooltip(event, this)">
											<span th:text="${book.title}"></span>
											(<span class="rating" th:text="|★${book.customerReviewRank}|"></span>)
										</div>
									</td>
									<td>
										<div class="book-author" th:data-full-text="${book.author}"
											th:text="${book.author}" onmousemove="showTooltip(event, this)">
											작가
										</div>
									</td>
									<td th:text="${book.firstCategory}">장르</td>
									<td th:text="${book.pubDate}">출판일</td>
								</tr>
								
							</th:block>
						</tbody>
					</table>
					<nav aria-label="Page navigation">
						<ul class="pagination" th:unless="${paramMap}" th:object="${pagination}">
							
							<!-- 첫 페이지로 이동 -->
							<li class="page-item" th:classappend="*{currentPage <= 1 || startPage == 1} ? 'disabled'">
								<a class="page-link py-1 px-2"
									th:href="*{currentPage <= 1 || startPage == 1} ? '#' : @{/book/bookList(cp=1)}"
									th:aria-disabled="*{currentPage <= 1 || startPage == 1}">&lt;&lt;</a>
							</li>

							<!-- 이전 페이지로 이동 -->
							<li class="page-item" th:classappend="*{currentPage <= 1 || startPage == 1} ? 'disabled'">
								<a class="page-link py-1 px-2"
									th:href="*{currentPage <= 1 || startPage == 1} ? '#' : @{/book/bookList(cp=*{prevPage})}"
									th:aria-disabled="*{currentPage <= 1 || startPage == 1}">이전</a>
							</li>

							<!-- 페이지 번호 -->
							<th:block th:each="i : *{#numbers.sequence(startPage, endPage)}">
								<li class="page-item" th:classappend="${i == pagination.currentPage} ? 'active'">
									<a class="page-link py-1 px-2"
										th:href="${i == pagination.currentPage} ? '#' : @{/book/bookList(cp=${i})}"
										th:text="${i}"
										th:aria-current="${i == pagination.currentPage} ? 'page'">현재페이지</a>
								</li>
							</th:block>

							<!-- 다음 페이지로 이동 -->
							<li class="page-item"
								th:classappend="*{currentPage >= maxPage || endPage == maxPage} ? 'disabled'">
								<a class="page-link py-1 px-2"
									th:href="*{currentPage >= maxPage || endPage == maxPage} ? '#' : @{/book/bookList(cp=*{nextPage})}"
									th:aria-disabled="*{currentPage >= maxPage || endPage == maxPage}">다음</a>
							</li>

							<!-- 마지막 페이지로 이동 -->
							<li class="page-item"
								th:classappend="*{currentPage >= maxPage || endPage == maxPage} ? 'disabled'">
								<a class="page-link py-1 px-2"
									th:href="*{currentPage >= maxPage || endPage == maxPage} ? '#' : @{/book/bookList(cp=*{maxPage})}"
									th:aria-disabled="*{currentPage >= maxPage || endPage == maxPage}">&gt;&gt;</a>
							</li>
							
						</ul>
						
						<ul class="pagination" th:if="${paramMap}" th:object="${pagination}">
							
							<!-- 첫 페이지로 이동 -->
							<li class="page-item" th:classappend="*{currentPage <= 1 || startPage == 1} ? 'disabled'">
								<a class="page-link py-1 px-2"
									th:href="*{currentPage <= 1 || startPage == 1} ? '#' : @{/book/bookList(cp=1)}"
									th:aria-disabled="*{currentPage <= 1 || startPage == 1}">&lt;&lt;</a>
							</li>

							<!-- 이전 페이지로 이동 -->
							<li class="page-item" th:classappend="*{currentPage <= 1 || startPage == 1} ? 'disabled'">
								<a class="page-link py-1 px-2"
									th:href="*{currentPage <= 1 || startPage == 1} ? '#' : @{/book/bookList(cp=*{prevPage})}"
									th:aria-disabled="*{currentPage <= 1 || startPage == 1}">이전</a>
							</li>

							<!-- 페이지 번호 -->
							<th:block th:each="i : *{#numbers.sequence(startPage, endPage)}">
							    <li class="page-item" th:classappend="${i == pagination.currentPage} ? 'active'">
							        <a class="page-link py-1 px-2"
							           th:href="${i == pagination.currentPage} 
							                    ? '#' 
							                    : @{/book/bookList(cp=${i}, searchType=${searchType}, searchInput=${searchInput}, genreFilter=${genreFilter}, ratingFilter=${ratingFilter})}"
							           th:text="${i}"
							           th:aria-current="${i == pagination.currentPage} ? 'page'">현재페이지</a>
							    </li>
							</th:block>


							<!-- 다음 페이지로 이동 -->
							<li class="page-item"
								th:classappend="*{currentPage >= maxPage || endPage == maxPage} ? 'disabled'">
								<a class="page-link py-1 px-2"
									th:href="*{currentPage >= maxPage || endPage == maxPage} ? '#' : @{/book/bookList(cp=*{nextPage})}"
									th:aria-disabled="*{currentPage >= maxPage || endPage == maxPage}">다음</a>
							</li>

							<!-- 마지막 페이지로 이동 -->
							<li class="page-item"
								th:classappend="*{currentPage >= maxPage || endPage == maxPage} ? 'disabled'">
								<a class="page-link py-1 px-2"
									th:href="*{currentPage >= maxPage || endPage == maxPage} ? '#' : @{/book/bookList(cp=*{maxPage})}"
									th:aria-disabled="*{currentPage >= maxPage || endPage == maxPage}">&gt;&gt;</a>
							</li>
							
						</ul>
						
					</nav>

				</div>
		</main>

		<!-- 푸터 추가-->
		<th:block th:replace="~{common/footer}"></th:block>

		<script src="/js/book/bookList.js"></script>

	</div>

</body>

</html>